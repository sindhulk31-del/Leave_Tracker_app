<div class="page-container">
  <!-- HEADER -->

  <div class="header-bar">
    <h5>Employees</h5>
    <div class="header-actions">
      <div class="search-box">
        <i class="fa fa-search"></i>
        <input type="text" placeholder="Search employee..." [(ngModel)]="searchText" (input)="searchEmployee()" />
      </div>

      <button class="btn-primary" (click)="openModal()">
        <i class="fa fa-plus"></i> New Employee
      </button>
    </div>
  </div>

  <!-- TABLE -->
  <div class="card">
    <table>
      <thead>
        <tr>
          <th>Sl.No</th>
          <th>Name</th>
          <th>Department</th>
          <th>Contact</th>
          <th>Email</th>
          <th width="120">Actions</th>
        </tr>
      </thead>
      <tbody>
        @for (item of filteredEmployees; track $index) {
        <tr>
          <td>{{ $index + 1 }}</td>
          <td>{{ item.empName }}</td>
          <td>{{ item.deptName }}</td>
          <td>{{ item.contactNo }}</td>
          <td>{{ item.email }}</td>
          <td class="action-cell">
            <button class="icon-btn edit" (click)="editEmployee(item)">
              <i class="fa fa-pencil"></i>
            </button>
            <button class="icon-btn delete" (click)="deleteEmployee(item.empId)">
              <i class="fa fa-trash"></i>
            </button>

          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>
</div>

<!--confimation popup-->
@if (showDeletePopup) {
<div class="popup-backdrop" *ngIf="showDeletePopup">
  <div class="popup-card">
    <h4>Confirm Delete</h4>
    <p>Are you sure you want to delete this employee?</p>

    <div class="popup-actions">
      <button class="btn cancel" (click)="closeDeletePopup()">
        Cancel
      </button>
      <button class="btn delete" (click)="confirmDelete()">
        Yes, Delete
      </button>
    </div>
  </div>
</div>
}

<!-- MODAL -->
@if (showModal) {
<div class="modal-backdrop" (click)="closeModal()">
  <div class="modal-box" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h5>
        {{ employeeForm.value.empId === 0 ? "New Employee" : "Edit Employee" }}
      </h5>
      <button class="close-btn" (click)="closeModal()">Ã—</button>
    </div>
    <form [formGroup]="employeeForm">


      <div class="modal-body">
        <div class="row">
          <div class="form-group">
            <label>Employee Name</label>
            <input class="form-control" formControlName="empName" [class.invalid]="isInvalid('empName')" />
            @if (employeeForm.get('empName')?.errors?.onlyAlphabets) {
            <small class="error">Only letters allowed</small>
            } @else if
            (isInvalid('empName')) {
            <small class="error">Name must be at least 3 characters</small> }
          </div>

          <div class="form-group">
            <label>Contact No</label>
            <input class="form-control" formControlName="contactNo" [class.invalid]="isInvalid('contactNo')" />
            @if (employeeForm.get('contactNo')?.errors?.mobile10) {
            <small class="error">Enter exactly 10 digits</small>
            } @else if
            (isInvalid('contactNo')) {
            <small class="error">Enter a valid 10-digit contact number</small> }
          </div>
        </div>

        <div class="row">
          <div class="form-group">
            <label>Email</label>
            <input class="form-control" formControlName="email" [class.invalid]="isInvalid('email')" />
            @if (isInvalid('email')) {
            <small class="error">Enter a valid email address</small> }
          </div>


          <div class="form-group">
            <label>Department</label>
            <input class="form-control" formControlName="deptName" [class.invalid]="isInvalid('deptName')" />
            @if (isInvalid('deptName')) {
            <small class="error">Department is required</small> }
          </div>
        </div>


        <div class="row">
          <div class="form-group">
            <label>Designation</label>
            <input class="form-control" formControlName="designation" [class.invalid]="isInvalid('designation')" />
            @if (isInvalid('designation')) {
            <small class="error">Designation is required</small> }
          </div>

          <div class="form-group">
            <label>Username</label>
            <input class="form-control" formControlName="userName" [class.invalid]="isInvalid('userName')" />
            @if (isInvalid('userName')) {
            <small class="error">Username must be at least 4 characters</small>
            }
          </div>
        </div>

        <div class="row">
          <div class="form-group">
            <label>Password</label>
            <input type="password" class="form-control" formControlName="password"
              [class.invalid]="isInvalid('password')" />
            @if (isInvalid('password') && employeeForm.get('password')?.errors?.['required']) {
            <small class="error">Password is required</small>
            }

            @if (isInvalid('password') && employeeForm.get('password')?.errors?.['minlength']) {
            <small class="error">Password must be at least 8 characters</small>
            }

            @if (isInvalid('password') && employeeForm.get('password')?.errors?.['strongPassword']) {
            <small class="error">
              Must include uppercase, lowercase, number & special character
            </small>
            }

          </div>
          <div class="form-group">
            <label>Role</label>
            <select class="form-control" formControlName="role" [class.invalid]="isInvalid('role')">
              <option value="">Select Role</option>
              <option value="Employee">Employee</option>
              <option value="Hr">Hr</option>
            </select>
            <small class="error" *ngIf="isInvalid('role')">
              Please select a role
            </small>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" type="button" (click)="closeModal()">
          Cancel
        </button>
        <button class="btn-primary" type="button"
          (click)="employeeForm.value.empId === 0 ? saveEmployee() : updateEmployee()">
          {{ employeeForm.value.empId === 0 ? "Save" : "Update" }}
        </button>
      </div>
    </form>
  </div>
</div>
}