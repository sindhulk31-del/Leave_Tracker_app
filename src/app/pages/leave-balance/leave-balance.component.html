<div class="container mt-4">

  <!-- HEADER -->
  <div class="d-flex justify-content-between mb-3">
    <div>
      <h4>Leave Balances</h4>
      <small class="text-muted">Employee leave overview</small>
    </div>

    <button class=" btn-new-leave" (click)="openModel()">
      <i class="fa fa-plus"></i> New Leave
    </button>
  </div>

  <!-- ================= TABLE VIEW ================= -->
  @if (!selectedEmployee) {

  <div class="card">
    <table class="table table-hover">
      <thead class="table-light">
        <tr>
          <th>Sl.No</th>
          <th>Emp ID</th>
          <th>Employee Name</th>
          <th>Total Leave Balance</th>
        </tr>
      </thead>

      <tbody>
        @for (emp of groupedEmployees; track $index) {
       <tr style="cursor:pointer"
    (click)="router.navigate(['/leave-balance', emp.empId])">

          <td>{{ $index + 1 }}</td>
          <td>{{ emp.empId }}</td>
          <td>{{ emp.empName }}</td>
          <td>{{ emp.paidLeave + emp.sickLeave }}</td>
        </tr>
        }
      </tbody>
    </table>
  </div>

  }

  <!-- ================= EMPLOYEE DETAIL ================= -->
  @if (selectedEmployee) {

 <button class="btn-btn-backTo"
        (click)="router.navigate(['/leave-balance'])">
  ‚Üê Back
</button>


  <h5>{{ selectedEmployee.empName }}</h5>

  <div class="row mt-3">

    <!-- PAID LEAVE -->
    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-body text-center">
          <h6 class="text-primary">Paid Leave</h6>
          <h2>{{ selectedEmployee.paidLeave }}</h2>
        </div>
      </div>
    </div>

    <!-- SICK LEAVE -->
    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-body text-center">
          <h6 class="text-success">Sick Leave</h6>
          <h2>{{ selectedEmployee.sickLeave }}</h2>
        </div>
      </div>
    </div>

  </div>
  }

</div>

<!-- ================= MODAL  ================= -->
@if (showModal) {
<div class="modal-backdrop" (click)="closeModel()">
  <div class="modal-box" (click)="$event.stopPropagation()">



      <div class="modal-header">
        <h5 class="modal-title">Leave Balance</h5>
        <button class="btn-close" (click)="closeModel()"></button>
      </div>

      <div class="modal-body">
        <div class="row g-3">

          <div class="col-md-6">
            <label>Employee</label>
            <select class="form-select" [(ngModel)]="newLeaveBalance.empId">
              <option [ngValue]="0">Select</option>
              @for (item of allEmployeesList$ | async; track $index) {
                <option [ngValue]="item.empId">{{ item.empName }}</option>
              }
            </select>
          </div>

          <div class="col-md-6">
            <label>Leave Type</label>
            <select class="form-select" [(ngModel)]="newLeaveBalance.leaveType">
              <option value="">Select</option>
              <option value="paidLeave">Paid Leave</option>
              <option value="sickLeave">Sick Leave</option>
            </select>
          </div>

          <div class="col-md-6">
            <label>Count</label>
            <input type="number" class="form-control"
                   [(ngModel)]="newLeaveBalance.count">
          </div>

        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeModel()">Cancel</button>
        <button class="btn-new-save" (click)="onSaveBalance()">Save</button>
      </div>

    </div>
  </div>
}
